<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akinator JKT48</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        .card {
            margin-bottom: 20px;
        }

        .card-header {
            text-align: center;
        }

        .card-header h1 {
            font-size: 2rem;
            font-weight: bold;
        }

        .card-header p {
            font-size: 1rem;
            color: gray;
        }

        .card-content {
            padding: 20px;
        }

        .progress-bar {
            height: 5px;
            background-color: #ccc;
            margin-bottom: 20px;
        }

        .thinking-icon {
            font-size: 48px;
            text-align: center;
            margin-bottom: 10px;
        }

        .hidden {
            display: none;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .btn {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .yes {
            background-color: #4CAF50;
            color: white;
        }

        .no {
            background-color: #f44336;
            color: white;
        }

        #game-over-text {
            text-align: center;
            margin-bottom: 20px;
        }

        #question-history {
            margin-top: 30px;
        }

        #history-list {
            list-style-type: none;
            padding: 0;
        }

        #history-list li {
            display: flex;
            justify-content: space-between;
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        .green {
            color: green;
        }

        .red {
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <header class="card-header">
                <h1>Akinators JKT48</h1>
                <p id="member-count"></p>
            </header>
            <div class="card-content">
                <div id="progress-bar" class="progress-bar"></div>

                <div id="question-section">
                    <div id="thinking-section" class="hidden">
                        <div class="thinking-icon">ðŸ§ </div>
                        <p>Sedang berpikir...</p>
                    </div>
                    <div id="question" class="hidden">
                        <p id="question-text"></p>
                        <div class="button-group">
                            <button id="yes-button" class="btn yes">Ya</button>
                            <button id="no-button" class="btn no">Tidak</button>
                        </div>
                    </div>
                    <div id="game-over-section" class="hidden">
                        <div id="game-over-text"></div>
                        <button id="restart-button" class="btn">Main Lagi</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="question-history" class="hidden">
            <h2>Riwayat Pertanyaan</h2>
            <ul id="history-list"></ul>
        </div>
    </div>

    <script>
        const membersUrl = 'https://raw.githubusercontent.com/FrenzY8/JKT48-Member/refs/heads/main/members.json';

        let members = [];
        let possibleMembers = [];
        let currentQuestion = null;
        let gameOver = false;
        let askedGeneration = null;
        let askedGraduated = false;
        let answeredQuestions = [];

        // Fetch members from the external URL
        async function fetchMembers() {
            const response = await fetch(membersUrl);
            const data = await response.json();
            return data;
        }

        // Generate the next question
        function generateQuestion() {
            if (askedGeneration === null) {
                return {
                    text: "Apakah member ini dari generasi 1-13?",
                    filter: (member, answer) => {
                        if (answer) {
                            askedGeneration = '1-13';
                            return member.generation >= 1 && member.generation <= 13;
                        }
                        return true;
                    }
                };
            }

            // Generation-specific questions
            if (askedGeneration === '1-13' && !askedGraduated) {
                return {
                    text: "Apakah member ini sudah lulus (graduated)?",
                    filter: (member, answer) => {
                        askedGraduated = true;
                        return answer ? member.graduated : !member.graduated;
                    }
                };
            }

            return null;
        }

        // Handle answer and filter members
        function filterMembers(answer) {
            const question = currentQuestion || generateQuestion();
            const filtered = possibleMembers.filter(member => question.filter(member, answer));

            answeredQuestions.push({ question: question.text, answer: answer ? "Ya" : "Tidak" });
            possibleMembers = filtered;

            const nextQuestion = generateQuestion();
            if (!nextQuestion || filtered.length === 1) {
                gameOver = true;
            } else {
                currentQuestion = nextQuestion;
            }

            updateUI();
        }

        // Update the UI based on the current game state
        function updateUI() {
            const memberCountText = `Tersisa ${possibleMembers.length} member dari ${members.length} total`;
            document.getElementById('member-count').textContent = memberCountText;

            const progress = ((members.length - possibleMembers.length) / members.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;

            if (gameOver) {
                displayGameOver();
            } else {
                displayQuestion();
            }

            // Update history
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';
            answeredQuestions.forEach(item => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `${item.question} <span class="${item.answer === 'Ya' ? 'green' : 'red'}">${item.answer}</span>`;
                historyList.appendChild(listItem);
            });
        }

        // Display the current question
        function displayQuestion() {
            document.getElementById('thinking-section').classList.add('hidden');
            document.getElementById('game-over-section').classList.add('hidden');
            document.getElementById('question-section').classList.remove('hidden');

            const questionText = currentQuestion.text;
            document.getElementById('question-text').textContent = questionText;

            document.getElementById('yes-button').onclick = () => filterMembers(true);
            document.getElementById('no-button').onclick = () => filterMembers(false);
        }

        // Display the game over message
        function displayGameOver() {
            document.getElementById('question-section').classList.add('hidden');
            document.getElementById('thinking-section').classList.add('hidden');
            document.getElementById('game-over-section').classList.remove('hidden');

            const gameOverText = possibleMembers.length === 1
                ? `Saya tebak membernya adalah: ${possibleMembers[0].name}`
                : `Masih ada ${possibleMembers.length} member yang cocok dengan kriteria`;
            document.getElementById('game-over-text').textContent = gameOverText;
        }

        // Restart the game
        function restartGame() {
            askedGeneration = null;
            askedGraduated = false;
            gameOver = false;
            answeredQuestions = [];
            possibleMembers = [...members];
            currentQuestion = generateQuestion();
            updateUI();
        }

        // Initialize game
        async function initGame() {
            members = await fetchMembers();
            possibleMembers = [...members];
            currentQuestion = generateQuestion();
            updateUI();

            document.getElementById('restart-button').onclick = restartGame;
        }

        // Start the game
        initGame();
    </script>
</body>
</html>
